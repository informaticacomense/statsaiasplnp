<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Profilo Utente</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-8">
  <h1 class="text-3xl font-bold text-blue-700 mb-6">‚úèÔ∏è Modifica Profilo</h1>

  <!-- Form Modificabile dall'utente -->
  <form id="profileForm" class="bg-white shadow rounded p-6 max-w-xl space-y-4">
    <input type="text" name="nome" placeholder="Nome" class="w-full border rounded px-3 py-2" required>
    <input type="text" name="cognome" placeholder="Cognome" class="w-full border rounded px-3 py-2" required>
    <input type="date" name="data_nascita" class="w-full border rounded px-3 py-2">
    <input type="text" name="luogo_nascita" placeholder="Luogo di Nascita" class="w-full border rounded px-3 py-2">
    <input type="text" name="indirizzo_residenza" placeholder="Indirizzo" class="w-full border rounded px-3 py-2">
    <input type="text" name="paese" placeholder="Paese" class="w-full border rounded px-3 py-2">
    <input type="text" name="cap" placeholder="CAP" class="w-full border rounded px-3 py-2">
    <input type="text" name="provincia" placeholder="Provincia" class="w-full border rounded px-3 py-2">
    <input type="text" name="club_appartenenza" placeholder="Club" class="w-full border rounded px-3 py-2">
    <input type="number" name="anni_esperienza" placeholder="Anni Esperienza" class="w-full border rounded px-3 py-2">

    <button type="submit" class="w-full bg-blue-600 text-white rounded py-2 hover:bg-blue-700">Salva Modifiche</button>
  </form>

  <!-- Campi in sola lettura -->
  <div class="bg-white shadow rounded p-6 max-w-xl mt-8">
    <h2 class="text-xl font-bold text-green-700 mb-4">üìò Dati Formazione</h2>
    <p><b>Sede Corso:</b> <span id="sede_corso">-</span></p>
    <p><b>Data Corso:</b> <span id="data_corso">-</span></p>
    <p><b>Certificazione LNP:</b> 
      <span id="certificato_lnp">No</span>
      <span id="badge_lnp" class="hidden bg-green-600 text-white px-2 py-1 rounded text-xs ml-2">‚úÖ Certificato LNP</span>
    </p>
  </div>

  <p id="resp" class="mt-4 text-green-600"></p>
  <button onclick="window.location.href='/dashboard.html'" class="mt-6 px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700">‚¨ÖÔ∏è Torna alla Dashboard</button>

  <script>
    async function loadProfile() {
      const res = await fetch('/me');
      if (!res.ok) return window.location.href="/index.html";
      const user = await res.json();

      // Campi modificabili
      for (const [key, value] of Object.entries(user)) {
        if (document.querySelector(`[name="${key}"]`)) {
          document.querySelector(`[name="${key}"]`).value = value || "";
        }
      }

      // Campi in sola lettura
      if (user.sede_corso) document.getElementById("sede_corso").innerText = user.sede_corso;
      if (user.data_corso) document.getElementById("data_corso").innerText = new Date(user.data_corso).toLocaleDateString();
      document.getElementById("certificato_lnp").innerText = user.certificato_lnp ? "S√¨" : "No";
      if (user.certificato_lnp) {
        document.getElementById("badge_lnp").classList.remove("hidden");
      }
    }

    document.getElementById('profileForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(e.target).entries());
      const res = await fetch('/update-profile', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      document.getElementById('resp').innerText = await res.text();
    });

    loadProfile();
  </script>
</body>
</html>
